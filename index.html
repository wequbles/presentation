<!doctype html>
<html lang="ru" data-theme="">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Философия интерфейса Telegram — Реконструкция UX</title>

  <!-- Basic look & feel (can be moved to style.css) -->
  <style>
    /*
      Theme system:
      - Default (light) variables in :root
      - Dark overrides in [data-theme="dark"]
      - JS will set document.documentElement.dataset.theme = 'dark' or '' based on localStorage / prefers-color-scheme
      - Also respects prefers-reduced-motion
    */
    :root{
      --bg: #ffffff;
      --page-gradient-top: var(--bg);
      --page-gradient-bottom: #f6fbff;
      --soft: #e9f4fb;
      --muted: #a8c8dc;
      --accent: #2aabee;
      --accent-strong: #0f86c2;
      --glass: rgba(255,255,255,0.7);
      --card-shadow: 0 8px 24px rgba(42,171,238,0.08);
      --radius: 16px;
      --maxw: 1100px;
      --container-pad: 20px;
      --font-sans: "Inter", Roboto, system-ui, -apple-system, "Segoe UI", "Helvetica Neue", Arial;
      --text: #0b2130;
      --muted-text: #507a88;
      --panel-bg: rgba(255,255,255,0.8);
      --panel-strong: #ffffff;
      --hint-bg: #ffffff;
      --hint-shadow: 0 8px 24px rgba(6,60,80,0.08);
      --focus-ring: rgba(42,171,238,0.18);
    }

    /* Dark theme overrides */
    [data-theme="dark"]{
      --bg: #06161b;
      --page-gradient-top: #041218;
      --page-gradient-bottom: #071e26;
      --soft: rgba(20,56,66,0.7);
      --muted: #48869c;
      --accent: #3fc4ff;
      --accent-strong: #60bfff;
      --glass: rgba(10,20,24,0.6);
      --card-shadow: 0 8px 30px rgba(0,0,0,0.6);
      --radius: 12px;
      --text: #d7eef8;
      --muted-text: #9cc6d6;
      --panel-bg: rgba(6,22,28,0.6);
      --panel-strong: rgba(8,28,36,0.9);
      --hint-bg: #052027;
      --hint-shadow: 0 8px 24px rgba(0,0,0,0.6);
      --focus-ring: rgba(63,196,255,0.18);
    }

    /* Respect user reduced motion preferences */
    @media (prefers-reduced-motion: reduce) {
      :root { --anim-duration: 0ms; }
    }
    :root { --anim-duration: 180ms; }

    html,body{height:100%;}
    html{scroll-behavior:smooth;} /* CSS fallback smooth scroll */
    body{
      margin:0;
      font-family:var(--font-sans);
      background: linear-gradient(180deg,var(--page-gradient-top) 0%, var(--page-gradient-bottom) 100%);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      justify-content:center;
      padding:40px 12px;
      transition:background var(--anim-duration) ease,color var(--anim-duration) ease;
    }

    .wrap{
      width:100%;
      max-width:var(--maxw);
      background:transparent;
    }

    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    .brand{
      display:flex;align-items:center;gap:12px;
    }
    .logo{
      width:56px;height:56px;border-radius:50%;background:var(--soft);display:flex;align-items:center;justify-content:center;box-shadow:var(--card-shadow);
      transition:box-shadow var(--anim-duration), background var(--anim-duration);
    }
    .logo svg{width:30px;height:30px}
    .site-title{font-weight:600;font-size:18px;color:var(--text)}

    /* Scenes layout */
    main{display:block}
    section.scene{
      min-height:72vh;
      margin:28px 0;
      padding:28px;
      border-radius:var(--radius);
      background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(233,244,251,0.6));
      box-shadow: 0 10px 30px rgba(10,30,50,0.04);
      position:relative;
      overflow:hidden;
      transition:opacity var(--anim-duration) ease, background var(--anim-duration) ease;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(233,244,251,0.02));
    }

    /* adjust scene background under dark theme */
    [data-theme="dark"] section.scene {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
    }

    /* Centered intro */
    .intro{
      display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;gap:18px;padding:60px 18px;
    }
    .intro h1{margin:0;font-size:20px;color:var(--text)}
    .intro p{max-width:780px;color:var(--muted-text);font-size:18px;margin:0}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:12px 18px;border-radius:12px;background:var(--accent);color:#04222b;border:none;cursor:pointer;font-weight:600;box-shadow:0 6px 18px rgba(42,171,238,0.18);transition:transform .12s ease, box-shadow .12s ease, background .12s ease}
    .btn:active{transform:translateY(1px)}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(42,171,238,0.12)}
    .btn.ghost[aria-pressed="true"]{background:rgba(42,171,238,0.08)}

    /* focus styles toggled by JS (keyboard navigation) */
    .show-focus :focus{outline:3px solid var(--focus-ring);outline-offset:3px;border-radius:8px}

    /* Scenes controls */
    .controls{display:flex;gap:12px;justify-content:center;margin-top:18px}

    /* Two-column Telegram mock */
    .mock{
      display:grid;grid-template-columns:320px 1fr;gap:18px;align-items:start;
    }
    .panel{
      background:var(--panel-bg);border-radius:12px;padding:14px;box-shadow:var(--card-shadow);backdrop-filter: blur(4px);
      transition:background var(--anim-duration), box-shadow var(--anim-duration);
      color:var(--text);
    }

    /* Chat list */
    .chat-list{max-height:60vh;overflow:auto;padding:6px}
    .chat-item{display:flex;gap:12px;align-items:center;padding:10px;border-radius:10px;cursor:pointer}
    .chat-item:hover{background:linear-gradient(90deg, rgba(42,171,238,0.06), rgba(42,171,238,0.03))}
    .avatar{width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,var(--soft),#dff4ff);display:flex;align-items:center;justify-content:center;font-weight:700;color:#065}
    .chat-meta{flex:1}
    .chat-name{font-weight:600}
    .chat-last{font-size:13px;color:var(--muted-text)}

    /* Tooltip hint */
    .hint{
      position:fixed;
      background:var(--hint-bg);
      border-radius:10px;
      padding:8px 12px;
      box-shadow:var(--hint-shadow);
      font-size:13px;
      color:var(--text);
      pointer-events:none;
      opacity:0;
      transform:translateY(6px);
      transition:opacity var(--anim-duration) ease, transform var(--anim-duration) ease;
      z-index:90;
      max-width:300px;
      white-space:normal;
      line-height:1.3;
      display:block;
    }
    /* arrow */
    .hint::after{
      content:'';
      position:absolute;
      width:0;height:0;
      border-style:solid;
      pointer-events:none;
    }
    /* placement variations */
    .hint[data-placement="top"]::after{
      bottom:-8px;
      left:16px;
      border-width:8px 8px 0 8px;
      border-color:var(--hint-bg) transparent transparent transparent;
      filter:drop-shadow(0 2px 4px rgba(6,60,80,0.06));
    }
    .hint[data-placement="bottom"]::after{
      top:-8px;
      left:16px;
      border-width:0 8px 8px 8px;
      border-color:transparent transparent var(--hint-bg) transparent;
      filter:drop-shadow(0 -2px 4px rgba(6,60,80,0.06));
    }
    .hint[data-placement="left"]::after{
      right:-8px;
      top:12px;
      border-width:8px 0 8px 8px;
      border-color:transparent transparent transparent var(--hint-bg);
      filter:drop-shadow(-2px 0 4px rgba(6,60,80,0.06));
    }
    .hint[data-placement="right"]::after{
      left:-8px;
      top:12px;
      border-width:8px 8px 8px 0;
      border-color:transparent var(--hint-bg) transparent transparent;
      filter:drop-shadow(2px 0 4px rgba(6,60,80,0.06));
    }

    /* Right placeholder */
    .placeholder{display:flex;align-items:center;justify-content:center;color:#6b8190;font-weight:600}

    /* Chat messages area */
    .messages{display:flex;flex-direction:column;gap:12px;height:60vh;overflow:auto;padding:16px}
    .msg{max-width:70%;padding:10px 14px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.03);cursor:default}
    .msg.me{align-self:flex-end;background:linear-gradient(180deg,#e8f9ff,#dff5fb)}
    .msg.them{align-self:flex-start;background:var(--panel-strong)}
    .msg.small{font-size:13px}

    /* settings modal */
    .modal-backdrop{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(6,28,38,0.35);display:none;align-items:center;justify-content:center;z-index:80}
    .modal{background:var(--panel-strong);padding:18px;border-radius:14px;max-width:520px;width:92%;box-shadow:0 18px 60px rgba(3,22,38,0.18)}
    .modal h3{margin:0 0 8px}
    .setting{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid rgba(6,30,40,0.04)}

    /* channels */
    .channel-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .post{background:var(--panel-strong);border-radius:12px;padding:12px;box-shadow:var(--card-shadow);display:flex;flex-direction:column;gap:8px}
    .post img{width:100%;height:110px;object-fit:cover;border-radius:8px}
    .post .meta{font-size:13px;color:var(--muted-text)}

    /* zen mode */
    .zen{display:none;align-items:center;justify-content:center;min-height:60vh;text-align:center}
    .zen.visible{display:flex}
    .zen h2{font-size:22px;color:var(--accent);margin:0}
    .zen p{max-width:720px;color:var(--muted-text);margin-top:8px}

    /* reflection */
    .reflection{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;padding:60px 12px}
    .reflection blockquote{font-size:20px;line-height:1.4;margin:0;color:var(--text);font-weight:600}

    /* small screen tweaks */
    @media (max-width:880px){
      .mock{grid-template-columns:1fr}
      .logo{width:48px;height:48px}
      .intro p{font-size:16px}
    }

    /* mobile responsiveness fixes */
    @media (max-width:600px) {
      body { padding: 20px 8px; }
      .scene { min-height: auto; padding: 20px 12px; margin: 16px 0; }
      .intro { padding: 40px 12px; gap: 12px; }
      .intro h1 { font-size: 18px; }
      .intro p { font-size: 14px; }
      .mock { gap: 12px; }
      .panel { padding: 12px; }
      .chat-list { max-height: 40vh; } /* reduce for mobile */
      .messages { height: 40vh; } /* reduce for mobile */
      header { gap: 8px; margin-bottom: 12px; }
      .brand { gap: 8px; }
      .logo { width: 40px; height: 40px; }
      .site-title { font-size: 16px; }
      .btn { padding: 10px 14px; font-size: 14px; }
      .channel-grid { grid-template-columns: 1fr; gap: 8px; } /* stack posts on very small screens */
      .reflection { padding: 40px 12px; }
      .reflection blockquote { font-size: 18px; }
      .zen { min-height: 50vh; }
      .zen h2 { font-size: 18px; }
      .zen p { font-size: 14px; }
      .zen p { max-width: none; }
    }

    /* fix chat-list on tablets/mobiles: keep vertical, not horizontal */
    @media (max-width:880px){
      .chat-list { display: block; overflow: auto; gap: 0; } /* override flex to block */
    }

    /* small utilities */
    .toolbar { display:flex;gap:8px;align-items:center }
    .theme-toggle { display:inline-flex;align-items:center;gap:8px;padding:8px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted-text);cursor:pointer }
    .theme-toggle svg{width:16px;height:16px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <!-- simple paper plane SVG in circle -->
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
            <circle cx="12" cy="12" r="11" fill="#e9f4fb" />
            <path d="M3 12L21 3L14 21L11 14L3 12Z" fill="#2aabee" opacity="0.95"/>
          </svg>
        </div>
        <div>
          <div class="site-title">Философия интерфейса — Telegram</div>
          <div style="font-size:12px;color:var(--muted-text)">Интерактивный UX-гайд</div>
        </div>
      </div>
      <div style="margin-left:auto;display:flex;gap:8px;align-items:center" class="toolbar">
        <button class="btn ghost" id="replayTop">Пройти заново</button>

        <!-- Theme toggle: button updates data-theme and localStorage -->
        <button id="themeToggle" class="theme-toggle" aria-pressed="false" title="Переключить тему" aria-label="Переключить тему">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path id="themeIcon" d="M12 3a1 1 0 0 1 1 1v2a1 1 0 1 1-2 0V4a1 1 0 0 1 1-1zM12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12z" fill="currentColor"/>
          </svg>
          <span id="themeLabel" style="font-size:13px;color:var(--muted-text)">Тема</span>
        </button>

        <button class="btn" id="zenBtn">Режим пустоты</button>
      </div>
    </header>

    <main>
      <!-- 1. Intro Scene -->
      <section id="intro" class="scene">
        <div class="intro">
          <div class="logo" style="width:96px;height:96px;border-radius:20px;box-shadow:0 16px 48px rgba(42,171,238,0.12);">
            <!-- bigger svg -->
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
              <circle cx="12" cy="12" r="11" fill="#e9f4fb" />
              <path d="M3 12L21 3L14 21L11 14L3 12Z" fill="#2aabee" opacity="0.95"/>
            </svg>
          </div>
          <h1>Что, если интерфейс не просто инструмент, а зеркало нашего отношения к свободе, скорости и контролю?</h1>
          <p>Погрузитесь в реконструкцию UX Telegram — где минимализм, скорость и суверенность пользователя переплетаются в одном опыте.</p>
          <div class="controls">
            <button class="btn" data-next="#chats">Начать реконструкцию</button>
          </div>
        </div>
      </section>

      <!-- 2. Chats View -->
      <section id="chats" class="scene">
        <h2 style="margin-top:6px">Экран диалогов</h2>
        <p style="color:var(--muted-text);max-width:800px">Минимализм без навязчивости — интерфейс исчезает, чтобы не мешать содержанию.</p>
        <div class="mock" style="margin-top:16px">
          <div class="panel">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
              <strong>Чаты</strong>
              <button class="btn ghost" id="openSettings" aria-haspopup="dialog">⚙️</button>
            </div>
            <div class="chat-list" id="chatList" role="list">
              <!-- list items created by JS for clarity -->
            </div>
          </div>

          <div class="panel placeholder" id="chatsRight">
            Выберите диалог
          </div>
        </div>
        <div style="margin-top:12px;color:var(--text);display:flex;gap:18px;flex-wrap:wrap">
          <div>Пользователь — субъект, не объект алгоритма.</div>
          <div>Нет ленты, нет давления — только выбор.</div>
        </div>
      </section>

      <!-- 3. Chat View -->
      <section id="chat" class="scene">
        <h2>Экран диалога</h2>
        <p style="color:var(--muted-text);max-width:800px">Интерфейс слушает — сообщения идут в ритме человека, не системы.</p>
        <div class="mock" style="margin-top:12px">
          <div class="panel chat-panel" style="padding:10px;">
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
              <div class="avatar">AB</div>
              <div>
                <div style="font-weight:700">Алексей</div>
                <div style="font-size:13px;color:var(--muted-text)">в сети</div>
              </div>
            </div>
            <div class="messages" id="messages" aria-live="polite" aria-atomic="false">
              <!-- messages generated in JS -->
            </div>
          </div>

          <div class="panel" style="display:flex;flex-direction:column;gap:8px;align-items:center;justify-content:center">
            <div style="font-weight:700;color:var(--text)">Интерпретация</div>
            <div style="font-size:14px;color:var(--muted-text);text-align:center;max-width:260px">Нажмите на сообщение, чтобы увидеть философский комментарий.</div>
            <div style="margin-top:8px">
              <button class="btn" id="backToChats">Назад в чаты</button>
            </div>
          </div>
        </div>
      </section>

      <!-- 4. Settings -->
      <section id="settingsScene" class="scene">
        <h2>Настройки</h2>
        <p style="color:var(--muted-text)">Настройка — инструмент суверенитета пользователя.</p>
        <div style="margin-top:12px;display:flex;gap:14px;flex-wrap:wrap">
          <div class="panel" style="flex:1;min-width:220px">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
              <div style="font-weight:700">Приватность</div>
              <div style="color:var(--muted-text)">Активна</div>
            </div>
            <div style="font-size:14px;color:var(--muted-text)">Приватность — форма самоуважения.</div>
          </div>
          <div class="panel" style="flex:1;min-width:220px">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
              <div style="font-weight:700">Синхронизация</div>
              <div style="color:var(--muted-text)">Включено</div>
            </div>
            <div style="font-size:14px;color:var(--muted-text)">Контроль — не паранойя, а суверенитет.</div>
          </div>
        </div>
      </section>

      <!-- 5. Channels / Media -->
      <section id="channels" class="scene">
        <h2>Каналы и медиа</h2>
        <p style="color:var(--muted-text)">Контент — посредник общения. Здесь нет сцены — только поток.</p>
        <div style="margin-top:12px" class="channel-grid" id="channelGrid">
          <!-- posts inserted by JS -->
        </div>
      </section>

      <!-- 6. Zen Mode (hidden, toggled) -->
      <section id="zenMode" class="scene">
        <div class="zen" id="zenBox" aria-hidden="true">
          <div>
            <h2>Когда исчезает интерфейс — остаётся только общение.</h2>
            <p>Идеальный UX — тот, которого не видно.</p>
            <div style="margin-top:12px">
              <button class="btn ghost" id="exitZen">Вернуть интерфейс</button>
            </div>
          </div>
        </div>
      </section>

      <!-- 7. Reflection -->
      <section id="reflect" class="scene">
        <div class="reflection">
          <blockquote>Каждый дизайн — это мировоззрение.<br>Telegram — это вера в человека, который умеет быть свободным.</blockquote>
          <div style="display:flex;gap:10px">
            <button class="btn" id="repeat">Пройти заново</button>
          </div>
        </div>
      </section>

    </main>

    <!-- Floating hint tooltip -->
    <div id="hint" class="hint" role="status" aria-hidden="true" data-placement="top"></div>

    <!-- settings modal (for ⚙️) -->
    <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle" tabindex="-1">
        <h3 id="settingsTitle">Настройки</h3>
        <div class="setting">
          <div>
            <div style="font-weight:700">Приватность</div>
            <div style="font-size:13px;color:var(--muted-text)">Кто видит последнее время — вы решаете.</div>
          </div>
          <div style="font-weight:600;color:var(--accent)">Вкл</div>
        </div>
        <div class="setting">
          <div>
            <div style="font-weight:700">Сообщения</div>
            <div style="font-size:13px;color:var(--muted-text)">Самоуничтожение — эфемерность в действии.</div>
          </div>
          <div style="font-weight:600;color:var(--accent)">Вкл</div>
        </div>
        <div style="margin-top:12px;text-align:right">
          <button class="btn ghost" id="closeModal">Закрыть</button>
        </div>
      </div>
    </div>

  </div>

  <!-- JavaScript (can be moved to script.js) -->
  <script>
    // Small helper to create elements easily
    const $ = (q,ctx=document)=>ctx.querySelector(q);
    const $$ = (q,ctx=document)=>Array.from(ctx.querySelectorAll(q));

    // Theme Initialization & Toggle
    (function initTheme(){
      const root = document.documentElement;
      const stored = localStorage.getItem('theme'); // 'dark' | 'light' | null
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      let theme = '';

      if(stored === 'dark' || (!stored && prefersDark)) {
        theme = 'dark';
      } else {
        theme = '';
      }
      if(theme === 'dark') {
        root.setAttribute('data-theme','dark');
        $('#themeToggle')?.setAttribute('aria-pressed','true');
        $('#themeLabel') && ($('#themeLabel').textContent = 'Тёмная');
      } else {
        root.removeAttribute('data-theme');
        $('#themeToggle')?.setAttribute('aria-pressed','false');
        $('#themeLabel') && ($('#themeLabel').textContent = 'Светлая');
      }
    })();

    $('#themeToggle')?.addEventListener('click', ()=>{
      const root = document.documentElement;
      const isDark = root.getAttribute('data-theme') === 'dark';
      if(isDark){
        root.removeAttribute('data-theme');
        localStorage.setItem('theme','light');
        $('#themeToggle').setAttribute('aria-pressed','false');
        $('#themeLabel').textContent = 'Светлая';
      } else {
        root.setAttribute('data-theme','dark');
        localStorage.setItem('theme','dark');
        $('#themeToggle').setAttribute('aria-pressed','true');
        $('#themeLabel').textContent = 'Тёмная';
      }
      // update icon (simple, replace path d)
      const icon = document.getElementById('themeIcon');
      if(icon) icon.setAttribute('d', isDark ? "M12 3a1 1 0 0 1 1 1v2a1 1 0 1 1-2 0V4a1 1 0 0 1 1-1zM12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12z" : "M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z");
    });

    // Scenes navigation
    document.querySelectorAll('[data-next]').forEach(btn=>{
      btn.addEventListener('click',e=>{
        const sel = btn.getAttribute('data-next');
        const dest = document.querySelector(sel);
        if(dest) dest.scrollIntoView({behavior:'smooth',block:'center'});
      });
    });

    // Replay / top button
    $('#replayTop').addEventListener('click', ()=>{
      const intro = document.getElementById('intro');
      if(intro) intro.scrollIntoView({behavior:'smooth'});
    });
    $('#repeat').addEventListener('click', ()=>{ const intro=document.getElementById('intro'); if(intro) intro.scrollIntoView({behavior:'smooth'}); });

    // Zen mode toggle
    const zenBtn = $('#zenBtn');
    const zenBox = $('#zenBox');
    zenBtn.addEventListener('click', ()=>{
      zenBox.classList.add('visible');
      zenBox.setAttribute('aria-hidden','false');
      const z = document.getElementById('zenMode');
      if(z) z.scrollIntoView({behavior:'smooth',block:'center'});
      document.querySelectorAll('main > section:not(#zenMode)').forEach(s=>s.style.opacity='0.08');
    });
    $('#exitZen').addEventListener('click', ()=>{
      zenBox.classList.remove('visible');
      zenBox.setAttribute('aria-hidden','true');
      document.querySelectorAll('main > section').forEach(s=>s.style.opacity='1');
      const intro = document.getElementById('intro');
      if(intro) intro.scrollIntoView({behavior:'smooth'});
    });

    // Hint tooltip — positioning
    const hint = $('#hint');

    function showHint(text, target){
      if(!hint) return;
      let rect;
      if (target instanceof Element) {
        rect = target.getBoundingClientRect();
      } else if (target && typeof target === 'object' && 'left' in target && 'top' in target && 'width' in target) {
        rect = target;
      } else if (typeof target === 'object' && 'clientX' in target && 'clientY' in target) {
        rect = { left: target.clientX, top: target.clientY, right: target.clientX, bottom: target.clientY, width: 0, height: 0 };
      } else {
        rect = { left: (target||0), top:  (arguments[2]||0), right: (target||0), bottom: (arguments[2]||0), width:0, height:0 };
      }

      hint.textContent = text;
      hint.style.left = '0px';
      hint.style.top = '0px';
      hint.style.opacity = '1';
      hint.setAttribute('aria-hidden','false');

      requestAnimationFrame(()=>{
        const hRect = hint.getBoundingClientRect();
        const vw = window.innerWidth;
        const vh = window.innerHeight;

        const spaceAbove = rect.top;
        const spaceBelow = vh - rect.bottom;
        const spaceLeft = rect.left;
        const spaceRight = vw - rect.right;

        let placement = 'top';
        if (spaceBelow > hRect.height + 16) placement = 'bottom';
        else if (spaceAbove > hRect.height + 16) placement = 'top';
        else if (spaceRight > hRect.width + 16) placement = 'right';
        else if (spaceLeft > hRect.width + 16) placement = 'left';
        else placement = (spaceBelow >= spaceAbove) ? 'bottom' : 'top';

        let left=0, top=0;

        if (placement === 'top') {
          top = rect.top - hRect.height - 12;
          left = rect.left + (rect.width/2) - (hRect.width/2);
        } else if (placement === 'bottom') {
          top = rect.bottom + 12;
          left = rect.left + (rect.width/2) - (hRect.width/2);
        } else if (placement === 'left') {
          left = rect.left - hRect.width - 12;
          top = rect.top + (rect.height/2) - (hRect.height/2);
        } else {
          left = rect.right + 12;
          top = rect.top + (rect.height/2) - (hRect.height/2);
        }

        const margin = 8;
        if (left < margin) left = margin;
        if (left + hRect.width > vw - margin) left = vw - hRect.width - margin;
        if (top < margin) top = margin;
        if (top + hRect.height > vh - margin) top = vh - hRect.height - margin;

        hint.style.left = Math.round(left) + 'px';
        hint.style.top = Math.round(top) + 'px';
        hint.setAttribute('data-placement', placement);
        hint.style.transform = 'translateY(0)';
      });
    }

    function hideHint(){
      if(!hint) return;
      hint.style.opacity = '0';
      hint.setAttribute('aria-hidden','true');
    }

    function refreshHintPosition() {
      if(!hint) return;
      if (hint.getAttribute('aria-hidden') === 'false') {
        hideHint();
      }
    }
    window.addEventListener('resize', refreshHintPosition);
    window.addEventListener('scroll', refreshHintPosition, {passive:true});

    // Create fake chat list (safe DOM methods)
    const chats = [
      {name:'Алиса',last:'Присылаю фото',id:'c1'},
      {name:'Бизнес',last:'Новое обновление',id:'c2'},
      {name:'Дизайн',last:'Может сделаем так?',id:'c3'},
      {name:'Паблик',last:'Сегодня в 19:00',id:'c4'},
      {name:'Ксюша',last:'😂😂😂',id:'c5'},
    ];
    const chatList = $('#chatList');
    chats.forEach(c=>{
      const el = document.createElement('div');
      el.className='chat-item';
      el.setAttribute('role','listitem');
      el.setAttribute('tabindex','0');
      el.dataset.hint = 'Минимализм без навязчивости — интерфейс исчезает, чтобы не мешать содержанию.';

      const av = document.createElement('div'); av.className='avatar'; av.textContent = c.name.slice(0,2);
      const meta = document.createElement('div'); meta.className='chat-meta';
      const title = document.createElement('div'); title.className='chat-name'; title.textContent = c.name;
      const last = document.createElement('div'); last.className='chat-last'; last.textContent = c.last;
      meta.appendChild(title); meta.appendChild(last);
      el.appendChild(av); el.appendChild(meta);

      el.addEventListener('mouseenter', e=> showHint(el.dataset.hint, el));
      el.addEventListener('mouseleave', hideHint);
      el.addEventListener('click', ()=>{
        const chatSection = document.getElementById('chat');
        if(chatSection) chatSection.scrollIntoView({behavior:'smooth',block:'center'});
        populateMessages(c);
      });
      el.addEventListener('keydown', e=>{
        if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); el.click(); }
      });

      chatList.appendChild(el);
    });

    // Messages data
    function populateMessages(chat){
      const msgs = [
        {who:'them',text:'Привет! Как дела? 😊',note:'Интерфейс не диктует — он слушает.'},
        {who:'me',text:'Всё отлично, работаю над проектом.',note:'Самоуничтожение — форма эфемерности.'},
        {who:'them',text:'Отправляю стикер',note:'Стикеры — эмоциональный язык.'},
        {who:'me',text:'Фото ниже',note:'Удалить для всех — власть над временем.'},
      ];
      const container = $('#messages'); container.innerHTML='';
      msgs.forEach(m=>{
        const d = document.createElement('div');
        d.className='msg '+(m.who==='me'?'me':'them')+' small';
        d.textContent = m.text;
        d.dataset.note = m.note;
        d.setAttribute('tabindex','0');
        d.addEventListener('mouseenter',(e)=> showHint(d.dataset.note, d));
        d.addEventListener('mouseleave', hideHint);
        d.addEventListener('click',(e)=>{
          showHint(d.dataset.note, d);
          setTimeout(hideHint,3000);
        });
        d.addEventListener('keydown', e=>{
          if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); d.click(); }
        });
        container.appendChild(d);
      });
      setTimeout(()=>container.scrollTop = container.scrollHeight,120);
    }

    // Back to chats
    $('#backToChats').addEventListener('click', ()=>{ const c=document.getElementById('chats'); if(c) c.scrollIntoView({behavior:'smooth',block:'center'}); });

    // Settings modal: open/close + close on backdrop click + Esc
    $('#openSettings').addEventListener('click', ()=>{ $('#modalBackdrop').style.display='flex'; $('#modalBackdrop').setAttribute('aria-hidden','false'); $('#modalBackdrop .modal').focus(); });
    $('#closeModal').addEventListener('click', closeModal);
    $('#modalBackdrop').addEventListener('click', (e)=>{
      if(e.target === $('#modalBackdrop')) closeModal();
    });
    function closeModal(){
      $('#modalBackdrop').style.display='none';
      $('#modalBackdrop').setAttribute('aria-hidden','true');
    }
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape') {
        if($('#modalBackdrop').style.display === 'flex') closeModal();
        if(zenBox.classList.contains('visible')) { $('#exitZen').click(); }
      }
    });

    // Channels grid population (safer DOM)
    const posts = [
      {title:'Утренний дайджест',img:'https://picsum.photos/seed/1/400/300'},
      {title:'Дизайн-мышление',img:'https://picsum.photos/seed/2/400/300'},
      {title:'Технологии',img:'https://picsum.photos/seed/3/400/300'},
      {title:'Философия общения',img:'https://picsum.photos/seed/4/400/300'},
    ];
    const grid = $('#channelGrid');
    posts.forEach(p=>{
      const c = document.createElement('div'); c.className='post'; c.setAttribute('tabindex','0');
      const t = document.createElement('div'); t.style.fontWeight='700'; t.textContent = p.title;
      const img = document.createElement('img'); img.src = p.img; img.alt = p.title; img.loading = 'lazy';
      const meta = document.createElement('div'); meta.className='meta'; meta.textContent = 'Контент как посредник общения';
      const btnWrap = document.createElement('div'); btnWrap.style.marginTop = '6px';
      const openBtn = document.createElement('button'); openBtn.className = 'openPost btn ghost'; openBtn.type='button'; openBtn.textContent = 'Открыть';
      openBtn.addEventListener('click', ()=>{ alert(p.title + '\n\n"Здесь нет сцены — только поток."'); });
      openBtn.addEventListener('mouseenter', ()=> showHint('Контент не цель — он посредник общения.', c));
      openBtn.addEventListener('mouseleave', hideHint);
      c.addEventListener('keydown', e=>{
        if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openBtn.click(); }
      });

      btnWrap.appendChild(openBtn);
      c.appendChild(t); c.appendChild(img); c.appendChild(meta); c.appendChild(btnWrap);
      grid.appendChild(c);
    });

    // small UX: hide hint when clicking elsewhere
    document.addEventListener('click', (e)=>{
      if(!e.target.closest('.chat-item') && !e.target.closest('.msg') && !e.target.closest('.post') && !e.target.closest('.openPost')) hideHint();
    });

    // small accessibility: focus outline for keyboard nav
    document.addEventListener('keydown', e=>{
      if(e.key==='Tab') document.body.classList.add('show-focus');
    });

    // initial scroll to top
    const intro = document.getElementById('intro');
    if(intro) intro.scrollIntoView();

  </script>
</body>
</html>
